<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <title>owo管理页面</title>
    <!-- 页面的元信息 -->
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=1200, user-scalable=no"/>
    <meta name="format-detection" content="telephone=no, email=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="white"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="filetype" content="1"/>
    <meta name="publishedtype" content="1"/>
    <meta name="pagetype" content="2"/>
    <meta name="screen-orientation" content="landscape"/>
    <meta name="x5-orientation" content="landscape"/>
    <meta name="full-screen" content="yes"/>
    <meta name="x5-fullscreen" content="true"/>
    <meta name="browsermode" content="application"/>
    <meta name="x5-page-mode" content="app"/>
    
      <!-- 页面主样式文件 -->
      <link charset="utf-8"  rel="stylesheet" href="./static/css/owo.main.css">
      
    <!-- 附属css文件 -->
    <link rel="stylesheet" href="./static/css/main.css" charset="utf-8">
      
  </head>
  <body>
    <!-- 页面区域 -->
    <!-- 页面[home]-->
    <div class="home owo" template="home"><div class="title-bar"><div class="mode-bar"></div><div class="save-button"><div class="icon"></div><span o-tap="seveConfig">发送</span></div></div><div class="content-box"><div class="menu"><a class="menu-item" href="?view-content=info"><div class="icon"></div><div class="text">页面概况</div></a><a class="menu-item" href="?view-content=else"><div class="icon"></div><div class="text">页面管理</div></a><a class="menu-item" href="?view-content=build"><div class="icon"></div><div class="text">打包配置</div></a><a class="menu-item" href="?view-content=log"><div class="icon"></div><div class="text">日志管理</div></a></div><div class="router" view="content"><div class="info" route="info"><div class="card-bar"><div class="card-bar-item"><h3>页面数量</h3><p o-html="this.data.config.pageList.length"></p></div><div class="card-bar-item"><h3>编译警告</h3><p style="color: #c1c187;" o-html="this.data.logInfo.warningNum">0</p></div><div class="card-bar-item"><h3> 编译报错</h3><p style="color: red;" o-html="this.data.logInfo.errorNum">0</p></div><div class="card-bar-item"><h3>页面大小</h3><p style="color: skyblue;">1.23Mb</p></div></div></div><div class="page" route="else"><table class="key-value-list" template="headKeyValueList"><tbody><tr><th>键名</th><th>键值</th><th>介绍</th><th>操作</th></tr>
<tr></tr>
<tr></tr>
<tr></tr>
<tr></tr>
<tr></tr></tbody></table><table class="style-list" template="styleList"></table><table class="scrip-list" template="scriptList"></table><table class="page-list" template="pageList"></table></div><div class="boild" o-if="this.data.copyConfig" route="build"><div class="card-box clear"><div class="card"><span>debug模式</span><input type="checkbox" o-value="this.data.copyConfig.debug" o-input="changeConfig('debug')"></div><div class="card"><span>外链提示</span><input type="checkbox" o-value="this.data.copyConfig.alertLink" o-input="changeConfig('alertLink')"></div><div class="card"><span>基本目录</span><input class="basePath" type="text" o-value="this.data.copyConfig.basePath" o-input="changeConfig('basePath')"></div><div class="card"><span>包裹容器</span><input class="basePath" type="text" o-value="this.data.copyConfig.container" o-input="changeConfig('container')"></div><div class="card"><span>手机入口</span><input class="basePath" type="text" o-value="this.data.copyConfig.phoneEnter" o-input="changeConfig('phoneEnter')"></div><div class="card"><span>项目目录</span><input class="root" type="text" o-value="this.data.copyConfig.root" o-input="changeConfig('root')"></div><div class="card"><span>打包输出目录</span><input class="outFolder" type="text" o-value="this.data.copyConfig.outFolder" o-input="changeConfig('outFolder')"></div><div class="card"><span>网页名称</span><input class="title" type="text" o-value="this.data.copyConfig.title" o-input="changeConfig('title')"></div><div class="card"><span>资源目录</span><input class="resourceFolder" type="text" o-value="this.data.copyConfig.resourceFolder"></div></div><div class="lable">服务设置</div><div class="card-box clear"><div class="card"><span>后台服务</span><input type="checkbox" o-value="this.data.copyConfig.server" o-input="changeConfig('server')"></div><div class="other" o-if="this.data.copyConfig.server"><div class="card"><span>服务端口</span><input class="serverPort" type="text" o-value="this.data.copyConfig.serverPort" o-input="changeConfig('serverPort')"></div><div class="card"><span>自动刷新页面</span><input type="checkbox" o-value="this.data.copyConfig.autoReload" o-input="changeConfig('autoReload')"></div><div class="card"><span>远程调试</span><input type="checkbox" o-value="this.data.copyConfig.remoteDebug" o-input="changeConfig('remoteDebug')"></div></div></div></div><div class="log" route="log"><ul></ul></div></div></div></div>
    

    <script src="./static/js/main.js" type="text/javascript"  charset="UTF-8"></script><!-- 框架script代码 --><!-- 框架script文件 -->
<script src="./static/js/owo.main.js" type="text/javascript" charset="UTF-8"></script>
<script>/*
  存储每个页面的函数
  键名：页面名称
  键值：方法列表
*/
owo.phoneEnter = "null";
owo.script = {
  "home": {
    "data": {
      "originalData": null,
      "contentItem": "info",
      "config": {},
      "logInfo": {},
      "needCreatFile": [],
      "activeMode": null
    },
    "show": function show() {
      var _this = this;

      fetch('../getControl').then(function (response) {
        return response.json();
      }).then(function (res) {
        _this.data.originalData = res; // 设置当前活跃模式

        var modeHtml = '';
        _this.data.activeMode = Object.keys(res.config.mode)[0];

        for (var key in res.config.mode) {
          if (res.config.mode.hasOwnProperty(key)) {
            var element = res.config.mode[key];
            modeHtml += "<span o-tap=\"changeActiveMode('" + key + "')\">" + key + "</span>";
          }
        }

        owo.query('.mode-bar')[0].innerHTML = modeHtml; // console.log(data)

        owo.tool.change(_this, {
          config: res.config,
          logInfo: res.log
        });
        owo.tool.emit('changeData', res.config);
        owo.tool.emit('changeLog', res.log); // 获取模式
        // console.log(res.config.mode)

        _owo.handleEvent(_this);
      });
    },
    "postData": function postData(url, data) {
      // Default options are marked with *
      return fetch(url, {
        body: JSON.stringify(data),
        // must match 'Content-Type' header
        cache: 'no-cache',
        // *default, no-cache, reload, force-cache, only-if-cached
        credentials: 'same-origin',
        // include, same-origin, *omit
        headers: {
          'user-agent': 'Mozilla/4.0 MDN Example',
          'content-type': 'application/json'
        },
        method: 'POST',
        // *GET, POST, PUT, DELETE, etc.
        mode: 'cors',
        // no-cors, cors, *same-origin
        redirect: 'follow',
        // manual, *follow, error
        referrer: 'no-referrer' // *client, no-referrer

      }).then(function (response) {
        return response.json();
      }); // parses response to JSON
    },
    "seveConfig": function seveConfig() {
      // console.log(this.data.config)
      this.postData('../setControl', {
        config: this.data.config,
        needCreatFile: this.data.needCreatFile
      }).then(function (res) {
        console.log(res);
      });
    },
    "changeConfig": function changeConfig(key) {
      this.data.config.mode[this.data.activeMode][key] = this.$target.value;
    },
    "changeActiveMode": function changeActiveMode(name) {
      console.log("\u66F4\u6539\u6D3B\u8DC3\u6A21\u5F0F\u4E3A: " + name);
      this.data.activeMode = name;
      owo.tool.emit('changeData', this.data.config);
    },
    "view": {
      "content": [{
        "prop": {
          "name": "info",
          "src": "./src/route/info.owo"
        },
        "_name": "info",
        "propMap": {}
      }, {
        "prop": {
          "name": "else",
          "src": "./src/route/else.owo"
        },
        "_name": "else",
        "propMap": {},
        "template": {
          "headKeyValueList": {
            "broadcast": {
              "changeData": function changeData(value) {
                var data = value.headList;
                var newHtml = '<tr><th>键名</th><th>键值</th><th>介绍</th><th>操作</th></tr>';
                data.forEach(function (element) {
                  newHtml += "<tr class=\"key-value-item\"><td class=\"td\">" + (element.name || element['http-equiv']) + "</td><td class=\"value\">" + element.content + "</td><td class=\"info\"></td><td class=\"tool\"><span class=\"icon\">&#xe645;</span></td></tr>";
                });
                this.$el.innerHTML = newHtml;
              }
            },
            "prop": {
              "_src": "./src/module/headKeyValueList.owo",
              "_name": "headKeyValueList"
            },
            "propMap": {}
          },
          "styleList": {
            "data": {
              "addNewNeedResource": false
            },
            "broadcast": {
              "changeData": function changeData(value) {
                var data = value.styleList;
                var newHtml = '<tr><th>脚本名</th><th>脚本路径</th><th width="70px">资源处理</th><th>操作</th></tr>';

                for (var key in data) {
                  if (data.hasOwnProperty(key)) {
                    var element = data[key];
                    newHtml += "<tr class=\"key-value-item\"><td class=\"name\">" + element.name + "</td><td class=\"value\">" + element.src + "</td><td class=\"resource icon" + (element.resource ? ' check' : '') + "\" ind=\"" + key + "\" o-tap=\"resourceChange\">" + (element.resource ? '&#xe661;' : '&#xe614;') + "</td><td class=\"tool\"><span class=\"icon\" o-tap=\"delete(" + key + ")\">&#xe645;</span></td></tr>";
                  }
                }

                newHtml += "<tr><td><input type=\"text\" placeholder=\"\u65B0\u589E\u6837\u5F0F\u540D\u79F0\" class=\"nameInput\"></input></td><td><input placeholder=\"\u65B0\u589E\u6837\u5F0F\u8DEF\u5F84\" type=\"text\" class=\"srcInput\"></input></td><td width=\"70px\" class=\"icon icon-box resource-check\" o-tap=\"addNewResourceChange\">&#xe614;</td><td class=\"tool icon\" o-tap=\"add\">&#xe600;</td></tr>";
                this.$el.innerHTML = newHtml;

                _owo.handleEvent(this);
              }
            },
            "resourceChange": function resourceChange() {
              var target = this.$target;
              var ind = parseInt(target.getAttribute('ind'));
              owo.script.home.data.config.styleList[ind].resource = !target.classList.contains('check');
              owo.tool.emit('changeData', owo.script.home.data.config);
            },
            "addNewResourceChange": function addNewResourceChange() {
              var target = this.$target;
              this.data.addNewNeedResource = !this.data.addNewNeedResource;

              if (this.data.addNewNeedResource) {
                target.classList.add('check');
                target.innerHTML = '&#xe661;';
              } else {
                target.classList.remove('check');
                target.innerHTML = '&#xe614;';
              }
            },
            "add": function add() {
              var name = this.$el.getElementsByClassName('nameInput')[0].value;
              var src = this.$el.getElementsByClassName('srcInput')[0].value;

              if (name && src) {
                owo.script.home.data.config.styleList.push({
                  name: name,
                  src: src,
                  resource: this.data.addNewNeedResource
                });
              }

              owo.tool.emit('changeData', owo.script.home.data.config);
            },
            "delete": function _delete(key) {
              owo.script.home.data.config.styleList.splice(key, 1);
              owo.tool.emit('changeData', owo.script.home.data.config);
            },
            "prop": {
              "_src": "./src/module/styleList.owo",
              "_name": "styleList"
            },
            "propMap": {}
          },
          "scriptList": {
            "data": {
              "resource": false,
              "babel": false,
              "defer": false
            },
            "broadcast": {
              "changeData": function changeData(value) {
                var data = value.scriptList;
                var newHtml = '<tr><th>脚本名</th><th>脚本路径</th><th width="70px">资源处理</th><th width="70px">babel</th><th width="70px">异步加载</th><th>操作</th></tr>';

                for (var key in data) {
                  if (data.hasOwnProperty(key)) {
                    var element = data[key];
                    newHtml += "<tr>\n            <td class=\"name\">" + element.name + "</td><td class=\"value\">" + element.src + "</td>\n            <td class=\"resource icon" + (element.resource ? ' check' : '') + "\" ind=\"" + key + "\" o-tap=\"changeValue('resource')\">" + (element.resource ? '&#xe661;' : '&#xe614;') + "</td>\n            <td class=\"babel icon" + (element.babel ? ' check' : '') + "\" ind=\"" + key + "\" o-tap=\"changeValue('babel')\">" + (element.babel ? '&#xe661;' : '&#xe614;') + "</td>\n            <td class=\"defer icon" + (element.defer ? ' check' : '') + "\" ind=\"" + key + "\" o-tap=\"changeValue('defer')\">" + (element.defer ? '&#xe661;' : '&#xe614;') + "</td>\n            <td class=\"tool\"><span class=\"icon\" o-tap=\"delete(" + key + ")\">&#xe645;</span></td></tr>";
                  }
                }

                newHtml += "\n          <tr>\n            <td><input type=\"text\" placeholder=\"\u65B0\u589E\u6837\u5F0F\u540D\u79F0\" class=\"nameInput\"></input></td>\n            <td><input placeholder=\"\u65B0\u589E\u6837\u5F0F\u8DEF\u5F84\" type=\"text\" class=\"srcInput\"></input></td>\n            <td width=\"70px\" class=\"icon icon-box resource-check\" o-tap=\"changeDataValue('resource')\">&#xe614;</td>\n            <td width=\"70px\" class=\"icon icon-box\" o-tap=\"changeDataValue('babel')\">&#xe614;</td>\n            <td width=\"70px\" class=\"icon icon-box\" o-tap=\"changeDataValue('defer')\">&#xe614;</td>\n            <td class=\"tool icon\" o-tap=\"add\">&#xe600;</td>\n          </tr>";
                this.$el.innerHTML = newHtml;

                _owo.handleEvent(this);
              }
            },
            "changeValue": function changeValue(key) {
              var target = this.$target;
              var ind = parseInt(target.getAttribute('ind'));
              owo.script.home.data.config.scriptList[ind][key] = !target.classList.contains('check');
              owo.tool.emit('changeData', owo.script.home.data.config);
            },
            "changeDataValue": function changeDataValue(dataItem) {
              var target = this.$target;
              this.data[dataItem] = !this.data[dataItem];

              if (this.data[dataItem]) {
                target.classList.add('check');
                target.innerHTML = '&#xe661;';
              } else {
                target.classList.remove('check');
                target.innerHTML = '&#xe614;';
              }
            },
            "add": function add() {
              var name = this.$el.getElementsByClassName('nameInput')[0].value;
              var src = this.$el.getElementsByClassName('srcInput')[0].value;

              if (name && src) {
                owo.script.home.data.config.scriptList.push({
                  name: name,
                  src: src,
                  resource: this.data.resource,
                  babel: this.data.babel,
                  defer: this.data.defer
                });
              } else {
                owo.tool.remind('名称和路径不能为空!');
              }

              owo.tool.emit('changeData', owo.script.home.data.config);
            },
            "delete": function _delete(key) {
              owo.script.home.data.config.scriptList.splice(key, 1);
              owo.tool.emit('changeData', owo.script.home.data.config);
            },
            "prop": {
              "_src": "./src/module/scriptList.owo",
              "_name": "scriptList"
            },
            "propMap": {}
          },
          "pageList": {
            "created": function created(params) {
              console.log('ss');
            },
            "broadcast": {
              "changeData": function changeData(value) {
                var data = value.pageList;
                var newHtml = '<tr><th>页面名</th><th>页面路径</th><th width="70px">类型</th><th>操作</th></tr>';

                for (var key in data) {
                  if (data.hasOwnProperty(key)) {
                    var element = data[key];
                    newHtml += "\n              <tr class=\"key-value-item\">\n                <td class=\"name\">" + element.name + "</td>\n                <td class=\"value\">" + element.src + "</td>\n                <td class=\"type icon\">\n                  <select value=\"" + element.type + "\">\n                    <option value =\"page\">\u9875\u9762</option>\n                    <option value =\"plug\">\u63D2\u4EF6</option>\n                  </select>\n                </td>\n                <td class=\"tool\"><span class=\"icon\" o-tap=\"delete(" + key + ")\">&#xe645;</span></td>\n              </tr>";
                  }
                }

                newHtml += "\n          <tr>\n            <td><input type=\"text\" placeholder=\"\u9875\u9762\u540D\u79F0\" o-input=\"changeSrc\" class=\"nameInput\"></input></td>\n            <td><input placeholder=\"\u9875\u9762\u8DEF\u5F84\" type=\"text\" class=\"srcInput\" disabled=\"disabled\"></input></td>\n            <td width=\"70px\" class=\"icon icon-box resource-check\" o-tap=\"changeDataValue('resource')\">\n              <select class=\"type-select\">\n                <option value =\"page\">\u9875\u9762</option>\n                <option value =\"plug\">\u63D2\u4EF6</option>\n              </select>\n            </td>\n            <td class=\"tool icon\" o-tap=\"add\">&#xe600;</td>\n          </tr>";
                this.$el.innerHTML = newHtml;

                _owo.handleEvent(this);
              }
            },
            "changeSrc": function changeSrc() {
              this.$el.getElementsByClassName('srcInput')[0].value = owo.script.home.data.config.root + "/page/" + this.$target.value + ".owo";
            },
            "add": function add() {
              var name = this.$el.getElementsByClassName('nameInput')[0].value;
              var src = this.$el.getElementsByClassName('srcInput')[0].value;

              if (name && src) {
                owo.script.home.data.config.pageList.push({
                  name: name,
                  src: src,
                  type: this.$el.getElementsByClassName('type-select')[0].value
                });
                owo.script.home.data.needCreatFile.push({
                  type: 'owo',
                  src: src
                });
              } else {
                owo.tool.remind('名称和路径不能为空!');
              }

              owo.tool.emit('changeData', owo.script.home.data.config);
            },
            "delete": function _delete(key) {
              owo.script.home.data.config.pageList.splice(key, 1);
              owo.tool.emit('changeData', owo.script.home.data.config);
            },
            "prop": {
              "_src": "./src/module/pageList.owo",
              "_name": "pageList"
            },
            "propMap": {}
          }
        }
      }, {
        "data": {
          "copyConfig": null
        },
        "broadcast": {
          "changeData": function changeData(config) {
            // console.log(owo.script.home.data.activeMode)
            owo.tool.change(this, {
              copyConfig: Object.assign(config.mode[owo.script.home.data.activeMode], config)
            });
          }
        },
        "changeConfig": function changeConfig(key) {
          this.data.config.mode[this.data.activeMode][key] = this.$target.value;
        },
        "prop": {
          "name": "build",
          "src": "./src/route/build.owo"
        },
        "_name": "build",
        "propMap": {}
      }, {
        "data": {
          "logInfo": []
        },
        "broadcast": {
          "changeLog": function changeLog(data) {
            var logHtml = "";
            data.logList.forEach(function (element) {
              logHtml += "<li class=\"" + element.type + "\">" + element.text + "</li>";
            }); // console.log(data)

            this.$el.getElementsByTagName('ul')[0].innerHTML = logHtml;
          }
        },
        "prop": {
          "name": "log",
          "src": "./src/route/log.owo"
        },
        "_name": "log",
        "propMap": {}
      }]
    }
  }
};</script>
  </body>
</html>